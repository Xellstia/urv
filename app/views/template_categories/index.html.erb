<div class="mx-auto max-w-6xl p-6 space-y-6">
  <div class="flex items-center justify-between">
    <h1 class="text-xl font-semibold">Шаблоны</h1>

    <%= form_with model: @new_category, url: template_categories_path, class: "flex gap-2" do |f| %>
      <%= f.text_field :name, placeholder: "Название категории", class: "rounded border px-3 py-1" %>
      <%= f.submit "Добавить категорию", class: "rounded bg-blue-600 px-3 py-1.5 text-white" %>
    <% end %>
  </div>

  <% @categories.each do |cat| %>
    <div class="rounded-2xl border bg-white">
      <div class="flex items-center justify-between p-3">
        <div class="font-semibold"><%= cat.name %></div>
        <div class="flex items-center gap-3 text-sm">
          <%= link_to (cat.collapsed ? "Развернуть" : "Свернуть"),
                      toggle_collapse_template_category_path(cat),
                      data: { turbo_method: :patch },
                      class: "text-gray-600 hover:underline" %>
          <%= link_to "Переименовать", edit_template_category_path(cat), class: "text-blue-600 hover:underline" %>
          <%= link_to "Удалить", template_category_path(cat),
                      data: { turbo_method: :delete, turbo_confirm: "Удалить категорию?" },
                      class: "text-red-600 hover:underline" %>
        </div>
      </div>

      <% unless cat.collapsed %>
        <div class="border-t p-3">
          <div class="flex items-center justify-between mb-3">
            <div class="text-sm text-gray-500">Карточки категории</div>
            <div class="flex gap-2">
              <%= link_to "Tempo", new_template_category_template_card_path(cat, system: :tempo),
                          class: "rounded border px-2 py-1 text-sm hover:bg-gray-50" %>
              <%= link_to "Яга", new_template_category_template_card_path(cat, system: :yaga),
                          class: "rounded border px-2 py-1 text-sm hover:bg-gray-50" %>
            </div>
          </div>

          <% cards = cat.template_cards %>
          <% if cards.any? %>
            <div class="grid grid-cols-5 gap-3">
              <% cards.each do |tc| %>
                <%= render "template_cards/card", card: tc %>
              <% end %>
            </div>
          <% else %>
            <p class="text-sm text-gray-400">Пока пусто. Добавьте карточки.</p>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
