<%# подключим helper времени %>
<%# app/helpers/time_helper.rb уже создан %>

<div class="mx-auto max-w-7xl p-6 space-y-6">
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-2">
      <%= link_to "←", { week_start: (@week_start - 7), weekend: @show_weekend }, class: "px-3 py-2 rounded border hover:bg-gray-50" %>
      <div class="font-semibold">
        <%= @week_start.strftime("%d %b") %> – <%= (@week_start + 6).strftime("%d %b %Y") %>
      </div>
      <%= link_to "→", { week_start: (@week_start + 7), weekend: @show_weekend }, class: "px-3 py-2 rounded border hover:bg-gray-50" %>
    </div>

    <div data-controller="weekend-toggle">
      <label class="inline-flex items-center gap-2 cursor-pointer">
        <input type="checkbox"
               data-weekend-toggle-target="toggle"
               data-action="weekend-toggle#change"
               <%= "checked" if @show_weekend %> />
        <span>Показать выходные</span>
      </label>
    </div>
  </div>

  <div class="<%= @show_weekend ? "grid grid-cols-7 gap-4" : "grid grid-cols-5 gap-4" %>">
    <% @days.each do |day| %>
      <% next unless @show_weekend || (1..5).cover?(day.cwday) %>
      <% items = @items_by_day[day] || [] %>
      <% total_min = @totals_by_day[day] || 0 %>

      <div class="rounded-2xl border bg-white p-3">
        <div class="flex items-center justify-between">
          <div class="font-semibold"><%= day.strftime("%a, %d %b") %></div>
          <div class="text-sm text-gray-500"><%= minutes_to_hhmm(total_min) %> / 8h</div>
        </div>

        <div class="mt-2 h-2 w-full rounded-full bg-gray-200">
          <div class="h-2 rounded-full bg-blue-500" style="width:<%= day_progress_width(total_min) %>"></div>
        </div>

        <div class="mt-3">
          <details class="mb-3">
            <summary class="cursor-pointer text-sm text-blue-600 hover:underline">+ Добавить карточку</summary>
            <div class="mt-2 rounded-lg border p-3">
              <%= render "work_items/form", date: day %>
            </div>
          </details>
        </div>

        <div class="mt-3 space-y-2">
          <% if items.any? %>
            <% items.each do |item| %>
              <%= render "work_items/card", item: item %>
            <% end %>
          <% else %>
            <p class="text-sm text-gray-400">Пока пусто. Здесь будут карточки.</p>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>

