<% url = work_item.persisted? ? work_item_path(work_item) : work_items_path %>
<% method = work_item.persisted? ? :patch : :post %>

<%= form_with url: url, method: method, scope: :work_item, data: { turbo_frame: "_top" } do %>
  <%= hidden_field_tag :week_start, week_start %>
  <%= hidden_field_tag :weekend, weekend %>

  <%= hidden_field_tag "work_item[date]", work_item.date %>
  <%= hidden_field_tag "work_item[system]", "tempo" %>

  <div class="grid gap-3">
    <!-- –ù–æ–º–µ—Ä –∑–∞–¥–∞—á–∏ -->
    <div>
      <label class="block text-sm text-gray-700">–ù–æ–º–µ—Ä –∑–∞–¥–∞—á–∏</label>
      <div class="flex gap-2">
        <input name="work_item[issue_key]" class="w-full rounded border px-2 py-1"
               placeholder="APP-123" value="<%= work_item.issue_key %>" />
        <button type="button" class="rounded border px-2" title="–ù–∞–π—Ç–∏">üîç</button>
      </div>
    </div>

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div>
      <label class="block text-sm text-gray-700">–û–ø–∏—Å–∞–Ω–∏–µ</label>
      <textarea name="work_item[description]" rows="3" class="w-full rounded border px-2 py-1"><%= work_item.description %></textarea>
    </div>

    <!-- –í—Ä–µ–º—è -->
    <div data-controller="time-input">
      <label class="block text-sm text-gray-700">–í—Ä–µ–º—è</label>
      <input type="text" data-time-input-target="visible"
             placeholder="1h30m / 1:30 / 90"
             class="w-full rounded border px-2 py-1" />
      <input type="hidden" name="work_item[minutes_spent]"
             value="<%= work_item.minutes_spent || 0 %>"
             data-time-input-target="hidden" />
    </div>

    <!-- –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ Tempo -->
    <div>
      <label class="block text-sm text-gray-700">–í–∏–¥ —Ä–∞–±–æ—Ç</label>
      <select name="work_item[tempo_work_kind]" class="w-full rounded border px-2 py-1">
        <% [["analysis","–ê–Ω–∞–ª–∏—Ç–∏–∫–∞"],["planning","–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"],["testing","–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"]].each do |val, label| %>
          <option value="<%= val %>" <%= "selected" if work_item.tempo_work_kind == val %>><%= label %></option>
        <% end %>
      </select>
    </div>

    <div class="grid grid-cols-2 gap-3">
      <div>
        <label class="block text-sm text-gray-700">–¶–° –î–µ–π—Å—Ç–≤–∏—è</label>
        <select name="work_item[tempo_cs_action]" class="w-full rounded border px-2 py-1">
          <% [["consulting","–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏"],["dev","–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞"]].each do |val, label| %>
            <option value="<%= val %>" <%= "selected" if work_item.tempo_cs_action == val %>><%= label %></option>
          <% end %>
        </select>
      </div>
      <div>
        <label class="block text-sm text-gray-700">–¶–° –ò–°</label>
        <select name="work_item[tempo_cs_is]" class="w-full rounded border px-2 py-1">
          <% [["core","–Ø–¥—Ä–æ"],["ui","–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã"]].each do |val, label| %>
            <option value="<%= val %>" <%= "selected" if work_item.tempo_cs_is == val %>><%= label %></option>
          <% end %>
        </select>
      </div>
    </div>

    <div class="flex gap-2">
      <button type="submit" class="rounded bg-blue-600 px-3 py-1.5 text-white">
        <%= work_item.persisted? ? "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" : "–°–æ–∑–¥–∞—Ç—å" %>
      </button>

      <% if work_item.persisted? %>
        <%= link_to "–û—Ç–º–µ–Ω–∞",
                    work_item_path(work_item, week_start: week_start, weekend: weekend),
                    data: { turbo_frame: dom_id(work_item) },
                    class: "rounded border px-3 py-1.5" %>
      <% else %>
        <button type="button"
                data-controller="frame-close"
                data-action="click->frame-close#close"
                class="rounded border px-3 py-1.5">
          –û—Ç–º–µ–Ω–∞
        </button>
      <% end %>
    </div>

  </div>
<% end %>
