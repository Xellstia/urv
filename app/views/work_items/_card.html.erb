<%= turbo_frame_tag dom_id(item) do %>
  <% state = item.state %>

  <div class="group rounded-xl border bg-white p-3 shadow-sm transition
              hover:shadow-md
              <%= state == "incomplete" ? "border-red-400 ring-1 ring-red-400" : "border-gray-200" %>"
       data-state="<%= state %>">

    <% unless state == "incomplete" %>
      <div class="h-1 -mt-3 -mx-3 rounded-t-xl
           <%= state == "synced" ? "bg-green-500" : "bg-amber-500" %>"></div>
    <% end %>

    <div class="mt-2 flex items-start justify-between gap-3">
      <div class="min-w-0">
        <div class="text-xs uppercase tracking-wide text-gray-500">
          <%= (item.system.presence || "tempo").to_s.upcase %>
          <%= item.issue_key.present? ? " · #{item.issue_key}" : "" %>
        </div>
        <div class="font-medium truncate">
          <%= item.description.presence || item.title.presence || "Запись без описания" %>
        </div>
      </div>

      <div class="flex flex-col items-end gap-2">
        <div class="text-sm font-semibold text-gray-800"><%= minutes_to_hhmm(item.minutes_spent || 0) %></div>

        <div class="flex gap-2">
          <%= link_to "Редактировать",
                      edit_work_item_path(item, week_start: @week_start, weekend: @show_weekend),
                      data: { turbo_frame: dom_id(item) },
                      class: "text-xs text-blue-600 hover:underline" %>

          <%= button_to "Удалить",
                        work_item_path(item, week_start: @week_start, weekend: @show_weekend),
                        method: :delete,
                        form: { data: { turbo_confirm: "Удалить карточку?" } },
                        class: "text-xs text-red-600 hover:underline bg-transparent p-0" %>
        </div>
      </div>
    </div>

    <% if state == "incomplete" %>
      <div class="mt-2 text-xs text-red-600">
        Не хватает обязательных полей (Issue/время).
      </div>
    <% end %>
  </div>
<% end %>
