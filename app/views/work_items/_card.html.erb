<%# locals: item = WorkItem %>
<% state = item.state %>

<div class="
  group rounded-xl border bg-white p-3 shadow-sm transition
  hover:shadow-md
  <%= state == "incomplete" ? "border-red-400 ring-1 ring-red-400" : "border-gray-200" %>
" data-state="<%= state %>">
  <% unless state == "incomplete" %>
    <div class="h-1 -mt-3 -mx-3 rounded-t-xl
      <%= state == "synced" ? "bg-green-500" : "bg-amber-500" %>"></div>
  <% end %>

  <div class="mt-2 flex items-start justify-between gap-3">
    <div class="min-w-0">
      <div class="font-medium truncate"><%= item.description.presence || "Запись без описания" %></div>
      <div class="mt-1 text-sm text-gray-500">
        <%= item.project_key.presence || "-" %> · <%= item.issue_key.presence || "-" %>
      </div>
    </div>

    <div class="flex flex-col items-end gap-2">
      <div class="text-sm font-semibold text-gray-800"><%= minutes_to_hhmm(item.minutes_spent || 0) %></div>

      <div class="flex gap-1">
        <%# Бейджи «провайдеров» (пока статично, позже привяжем к ExternalMapping) %>
        <span class="inline-flex items-center rounded-md border px-1.5 py-0.5 text-[11px]
          <%= state == "synced" ? "border-green-500 text-green-700" : "border-gray-300 text-gray-600" %>">
          Tempo
        </span>
        <span class="inline-flex items-center rounded-md border px-1.5 py-0.5 text-[11px]
          <%= state == "synced" ? "border-green-500 text-green-700" : "border-gray-300 text-gray-600" %>">
          Yaga
        </span>
      </div>
    </div>
  </div>

  <% if state == "incomplete" %>
    <div class="mt-2 text-xs text-red-600">
      Не хватает обязательных полей (Issue или Project).
    </div>
  <% end %>
</div>
