<%# Карточка WorkItem поверх универсального компонента %>
<%# Используем хелпер display_work_item_code(item) для безопасного извлечения кода %>

<%= render "shared/card",
      id:        item,
      state:     item.state&.to_sym,
      kind:      item.system&.to_sym,                                     # :tempo / :yaga / :otrs
      title:     (item.description.presence || item.title),               # описание в теле
      desc:      nil,
      code:      display_work_item_code(item),                            # <-- теперь всегда стараемся показать код
      minutes:   item.minutes_spent,
      actions:   "work_items/card_actions",
      edit_path: edit_work_item_path(item, week_start: params[:week_start], weekend: params[:weekend]) %>
